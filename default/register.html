<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">
  <link rel="stylesheet" href="../css/bootstrap-4.3.1.css">
  <script src="../jquery/jquery-3.4.1.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container"> <button class="navbar-toggler navbar-toggler-right border-0" type="button"
        data-toggle="collapse" data-target="#navbar12">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar12"> <a class="navbar-brand d-none d-md-block" href="#">
          <i class="fa d-inline fa-lg fa-circle"></i>
          <b> BRAND</b>
        </a>
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"> <a class="nav-link text-primary" href="#" contenteditable="true">WebAPI</a> </li>
          <li class="nav-item"> <a class="nav-link text-primary" href="#">首页</a> </li>
          <li class="nav-item"> <a class="nav-link text-primary" href="#">新闻动态</a> </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item"> <a id="state" data-state="user" class="nav-link text-primary"><i
                class="fa fa-user fa-fw"></i>Admin Register</a> </li>
          <li class="nav-item"> <a class="nav-link text-primary" href="Login.html"><i class="fa fa-sign-in"
                aria-hidden="true"></i>登录</a> </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-5 text-center">
    <div class="container">
      <div class="row">
        <div class="mx-auto col-lg-6 col-10">
          <h1 id="title">注册用户账号</h1>
          <p class="mb-3">请您完成以下各项信息的填写，我们会保障您的个人隐私不会泄露及滥用。</p>
          <form class="text-left" id="register">
            <div class="form-group"> <label for="Name">Your Name</label>
              <input type="text" class="form-control" id="Name" placeholder="name" required="required">
              <small id="nameNote" class="form-text text-muted"></small>
            </div>
            <div class="form-group" id="companyGroup"> <label for="company">Your Company</label> <input type="text"
                class="form-control" id="company" placeholder="company"> </div>
            <div class="form-group"> <label for="email">Your email</label> <input type="email" class="form-control"
                id="email" placeholder="name@example.com" required="required">
              <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
              <small id="emailNote" class="form-text text-muted"></small>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6"> <label for="password"">Password</label> <input type="password"class="form-control" id="password" required="required">
                  <small id="passwordNote" class="form-text text-muted"></small>
              </div>
              <div class="form-group col-md-6"> <label for="confirmPassword">Confirm Password</label> <input
                  type="password" class="form-control" id="confirmPassword" required="required"> </div>
            </div>
            <div class='form-group' id='reasonGroup'></div>
            <div class="d-flex justify-content-center">
              <button type="submit" class="btn btn-primary">注册</button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
  <div class="py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center d-md-flex align-items-center"> <i
            class="d-block fa fa-stop-circle fa-2x mr-md-5 text-primary"></i>
          <ul class="nav mx-md-auto d-flex justify-content-center">
            <li class="nav-item"> <a class="nav-link active" href="#">Home</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Features</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Pricing</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">About</a> </li>
          </ul>
          <div class="row">
            <div class="col-md-12 d-flex align-items-center justify-content-md-between justify-content-center my-2"> <a
                href="#">
                <i class="d-block fa fa-facebook-official text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-instagram text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-twitter text-muted fa-lg ml-2"></i>
              </a> </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">
          <p class="mt-2 mb-0">© 2014-2018 Pingendo. All rights reserved</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    var form = $("#register");
    var email = $("#email");
    var title = $("#title");
    var Name = $("#Name");
    var company;
    var reason;
    var nameNote = $("#nameNote");
    var password = $("#password");
    var passwordNote = $("#passwordNote");
    var emailNote = $("#emailNote");
    $(document).ready(stateManage());
    $(document).ready(registerManage());
    // 切换登录模式
    function stateManage() {
      $("#state").click(function () {
        if ($(this).data("state") == "user") {
          $(this).data("state", "admin");
          $("#title").text("管理员登录");
          updateAdminContent();

          $(this).html("<i class='fa fa-user-circle-o' aria-hidden='true'></i>User Register");
        } else if ($(this).data("state") == "admin") {
          $(this).data("state", "user");
          $("#title").text("用户登录");
          $(this).html("<i class='fa fa-user fa-fw' aria-hidden='true'></i>Admin Register");
          updateUserContent();

        }
      });
    }



    function registerManage() {
      form.submit(function (e) {
        e.preventDefault();
        if ($("#state").data("state") == "user") {
          registerUser();
        } else {
          registerAdmin();
        }
      })
    }


    function check() {
      if ($.trim(Name.val()) == "") {
        Name.focus();
        nameNote.text("请输入名称!");
        return false;
      }
      nameNote.text("");
      var rep = /^[a-zA-Z0-9]+@(\d{3}|[a-zA-Z]{2,4}).[a-zA-Z]{2,3}$/;
      if (!rep.test($.trim(email.val()))) {
        email.focus();
        emailNote.text("邮箱格式不对！");
        return false;
      }
      emailNote.text("");
      if (password.val() != $("#confirmPassword").val()) {
        passwordNote.text("密码不一致！")
        return false;
      }
      if ($.trim(password.val()) == "") {
        password.focus();
        passwordNote.text("密码不能为空！")
        return false;
      }
      passwordNote.text("");

      return true;
    }

    function updateAdminContent() {
      var content = "<label>Reason</label><textarea class='form-control' maxlength='290'id='reason' rows='3' placeholder='您需要告知我们，您注册该账号的原因。'></textarea>";
      title.html("注册管理员账号");
      $("#reasonGroup").html(content);
      $("#companyGroup").empty();
      
    }
    function updateUserContent() {
      var content = "<label for='company'>Your Company</label> <input type='text' class='form-control' id='company' placeholder='company'>";
      title.html("注册用户账号");
      $("#companyGroup").html(content);
      $("#reasonGroup").empty();
    }
    
    function registerUser() {

      if (!check()) {
        return false;
      }
      company = $("#company");
      var registerData = {
        "name": $.trim(Name.val()),
        "company": $.trim(company.val()),
        "email": $.trim(email.val()),
        "password": $.trim(password.val())
      };
      $.ajax({
        url: "http://localhost:8080/api/user/email",
        type: "get",
        data: {
          "email": $.trim(email.val())
        },
        success: function (emailDate) {
          if (emailDate.id != null) {
            emailNote.text("该邮箱已被其他人使用");
            email.focus();
            return;
          } else {
            $.ajax({
              url: "http://localhost:8080/api/user/",
              type: "post",
              data: JSON.stringify(registerData),
              contentType: "application/json;charset=utf-8;",
              dataType: "json",
              success: function (data) {
                if (data) {
                  alert("注册成功！");
                  window.location.href = "login.html";
                } else {
                  alert("注册失败！");
                }
              },
              error: function () {
                alert("连接服务器出错！");
              }
            })
          }
        },
        error: function () {
          alert("连接服务器出错！");
        }
      })

    }

    function registerAdmin() {
      if (!check()) {
        return false;
      }
      $.ajax({
        url: "http:localhost:8080/api/admin/email",
        type: "get",
        data: {
          "email": $.trim(email.val())
        },
        success: function (emailDate) {
          if (emailDate.id != null) {
            emailNote.text("该邮箱已被其他人使用");
            email.focus();
            return;
          } else {
            reason = $("#reason");
            var registerData = {
              "name": $.trim(Name.val()),
              "date": getDate(),
              "email": $.trim(email.val()),
              "password": $.trim(password.val()),
              "reason": $.trim(reason.val())
            };
            $.ajax({
              url: "http://localhost:8080/api/applyForAdmin/",
              type: "post",
              data: JSON.stringify(registerData),
              contentType: "application/json;charset=utf-8;",
              dataType: "json",
              success: function (data) {
                if (data) {
                  alert("注册成功！");
                  window.location.href = "login.html";
                } else {
                  alert("注册失败！");
                }
              },
              error: function () {
                alert("连接服务器出错！");
              }
            })
          }
        },
        error: function () {
          alert("连接服务器出错！");
        }
      })
    }


    function getDate() {
      var myDate = new Date;
      var year = myDate.getFullYear(); //获取当前年
      var month = myDate.getMonth() + 1; //获取当前月
      var strDate = myDate.getDate(); //获取当前日
      if (month >= 1 && month <= 9) {
        month = "0" + month;
    }
    if (strDate >= 0 && strDate <= 9) {
        strDate = "0" + strDate;
    }
    return "" + year + "-" + month + "-" + strDate;
  }

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</body>

</html>