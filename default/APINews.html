<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        type="text/css">
    <link rel="stylesheet" href="../css/bootstrap-4.3.1.css">
    <script src="../jquery/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <div class="container"> <button class="navbar-toggler navbar-toggler-right border-0" type="button"
                data-toggle="collapse" data-target="#navbar12">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar12"> <a class="navbar-brand d-none d-md-block" href="#">
                    <i class="fa d-inline fa-lg fa-circle"></i>
                    <b> BRAND</b>
                </a>
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"> <a class="nav-link text-primary" href="Feedback.html">意见反馈</a></li>
                    <li class="nav-item"> <a class="nav-link text-primary" href="Home.html">首页</a> </li>
                    <li class="nav-item"> <a class="nav-link text-primary" href="APINews.html">资讯动态</a> </li>
                    <li class="nav-item"> <a class="nav-link text-primary" href="Search.html">WebAPI</a> </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item"> <a href="#" id="state" data-state="User" class="nav-link text-primary">
                            <i class='fa fa-user-circle-o' aria-hidden='true'></i>User Sign</a> </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="py-5 text-center"
        style="background-image: url(&quot;image/image4.jpg&quot;); background-position: right bottom; background-size: cover; background-repeat: repeat; background-attachment: fixed;">
        <div class="container">
            <div class="row justify-content-center align-items-center" style="">
                <div class="bg-white p-4 col-10 mx-auto mx-md-0 col-lg-6">
                    <h1>资讯查找</h1>
                    <form class="form-inline d-flex justify-content-center">
                        <div class="input-group"> <input type="search" class="form-control" placeholder="please input"
                                id="searchContent">
                            <div class="btn-group">
                                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                                    data-toggle="dropdown" aria-expanded="false"></button>
                                <div class="input-group-append"> <button class="btn btn-primary" id="search"
                                        type="button" contenteditable="true">Search</button> </div>
                                <div class="dropdown-menu" id="dropdownMenu" x-placement="bottom-start"
                                    style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">
                                    <a class="dropdown-item" data-menu="name" href="#">资讯名称</a>
                                    <a class="dropdown-item" data-menu="author" href="#">作者</a>
                                    <a class="dropdown-item" data-menu="category" href="#">类别</a>
                                    <a class="dropdown-item" data-menu="date" href="#">日期</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" data-menu="dateSection" href="#">日期区间</a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="py-5">
        <div class="container">


            <div id="tab1" class="d-flex justify-content-center">

                <div id="footerParent">
                </div>
            </div>

        </div>
    </div>




    <div class="py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center d-md-flex align-items-center"> <i
                        class="d-block fa fa-stop-circle fa-2x mr-md-5 text-primary"></i>
                    <ul class="nav mx-md-auto d-flex justify-content-center">
                        <li class="nav-item"> <a class="nav-link active" href="#">Home</a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#">Features</a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#">Pricing</a> </li>
                        <li class="nav-item"> <a class="nav-link" href="#">About</a> </li>
                    </ul>
                    <div class="row">
                        <div
                            class="col-md-12 d-flex align-items-center justify-content-md-between justify-content-center my-2">
                            <a href="#">
                                <i class="d-block fa fa-facebook-official text-muted fa-lg mx-2"></i>
                            </a> <a href="#">
                                <i class="d-block fa fa-instagram text-muted fa-lg mx-2"></i>
                            </a> <a href="#">
                                <i class="d-block fa fa-twitter text-muted fa-lg ml-2"></i>
                            </a> </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 text-center">
                    <p class="mt-2 mb-0">© 2014-2018 Pingendo. All rights reserved</p>
                </div>
            </div>
        </div>
    </div>


    <script>


        // 定义全局变量方便下面进行页面刷新和实现页面跳转
        var pageNum = 1;
        var searchUrl = "";
        var searchType = "";
        var searchValue = "";
        var data1 = {};


        var stateData = JSON.parse(sessionStorage.getItem("stateData"));
        $(document).ready(init());
        function init() {

            var login = sessionStorage.getItem("login");
            if (login != "true" || typeof (stateData) == "undefined" || $.isEmptyObject(stateData)) {
                window.location.href = "Login.html";
            }

            $("#state").html("<i class='fa fa-user-circle-o' aria-hidden='true'></i>" + stateData.name);


        }

        // 实现搜索功能
        function search() {

            $("#search").click(function () {
                var searchContent = $.trim($("#searchContent").val());
                pageNum = 1;
                if (searchContent == "") {
                    searchUrl = "http://localhost:8080/api/apiNews/";
                    searchType = "get";
                    data1 = {
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                } else if (searchValue == "name") {
                    searchUrl = "http://localhost:8080/api/apiNews/name";
                    searchType = "get";
                    data1 = {
                        "name": searchContent,
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                } else if (searchValue == "author") {
                    searchUrl = "http://localhost:8080/api/apiNews/author";
                    searchType = "get";
                    data1 = {
                        "author": searchContent,
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                } else if (searchValue == "category") {
                    searchUrl = "http://localhost:8080/api/apiNews/category";
                    searchType = "get";
                    data1 = {
                        "category": searchContent,
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                } else if (searchValue == "data") {
                    searchUrl = "http://localhost:8080/api/apiNews/data";
                    searchType = "get";
                    data1 = {
                        "data": searchContent,
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                } else if (searchValue == "dateSection") {
                    searchUrl = "http://localhost:8080/api/apiNews/dateSection";
                    searchType = "get";
                    data1 = {
                        "dateSection": searchContent,
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                } else {
                    searchUrl = "http://localhost:8080/api/apiNews/all";
                    searchType = "get";
                    data1 = {
                        "val": searchContent,
                        "pageNum": pageNum
                    };
                    ajaxAPI(data1);
                }
            });
        }
        $(document).ready(dropdownMenu());
        $(document).ready(search());
        $(document).ready(function () {
            $("#search").click();
        });

        // 实现与服务器的沟通，主要为了减少代码量
        function ajaxAPI(data1) {
            $.ajax({
                url: searchUrl,
                type: searchType,
                data: data1,
                success: function (data) {
                    tableContent(data.list);
                    if (data.pages > 1) {
                        footerContent(data.pageNum, data.hasPreviousPage, data.hasNextPage, data.navigatepageNums);
                        footerEnterAPI(data1);
                    }
                    showResult("查询成功");
                },
                error: function () {
                    $("#tab1").empty();
                    showResult("error!!!");
                }
            })
        }
        // 实现页脚在界面的显示
        function footerContent(pageNum, hasPreviousPage, hasNextPage, navigatepageNums) {
            var content = "<ul class='pagination justify-content-center' id='footer'>";
            if (!hasPreviousPage) {
                $.each(navigatepageNums, function (i, val) {
                    if (i == 0) {
                        content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
                    } else if (i <= 3) {
                        content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
                    } else {
                        content += "<li class='page-item'> <a class='page-link' href='#'  data-pagenum=" + val + ">" + "Next" + "</a></li>"
                    }
                })
            } else if (!hasNextPage) {
                $.each(navigatepageNums, function (i, val) {
                    if (i == 0) {
                        content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + "Prev" + "</a></li>"
                    } else if (i < Object.keys(navigatepageNums).length - 1) {
                        content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
                    } else {
                        content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
                    }
                })
            } else {
                $.each(navigatepageNums, function (i, val) {
                    if (i == 0) {
                        content += "<li class='page-item'> <a class='page-link'  href='#' data-pagenum=" + val + ">" + "Prev" + "</a></li>"
                    } else if (i < 4) {
                        if (val != pageNum) {
                            content += "<li class='page-item' > <a class='page-link'  href='#' data-pagenum=" + val + ">" + val + "</a></li>"
                        } else {
                            content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a>								</li>"
                        }
                    } else {
                        content += "<li class='page-item'> <a class='page-link'  href='#' data-pagenum=" + val + ">" + "Next" + "</a></li>"
                    }
                })
            }
            content += "</ul>";
            $("#footerParent").html(content)
        }
        // 实现根据页脚进行跳转的功能
        function footerEnterAPI(data1) {
            $("#footer").click(function (event) {
                pageNum = $(event.target).data("pagenum");
                reFresh(data1);
            })
        }
        // 刷新界面
        function reFresh(data1) {
            data1.pageNum = pageNum;
            $.ajax({
                url: searchUrl,
                type: searchType,
                data: data1,
                success: function (data) {
                    tableContent(data.list);
                    if (data.pages > 1) {
                        footerContent(data.pageNum, data.hasPreviousPage, data.hasNextPage, data.navigatepageNums);
                        footerEnterAPI(data1);
                    }
                },
                error: function () {
                    $("#tab1").empty();
                    showResult("刷新界面失败!!!");
                }
            })
        }
        // 获取搜索下拉菜单的选项值
        function dropdownMenu() {
            $("#dropdownMenu").click(function (event) {
                searchValue = $(event.target).data("menu");
            })
        }
        // 根据列表填充表格内容
        function tableContent(list) {
            var content = "<ul class='list-group list-group-flush'>";
            $.each(list, function (i, val) {
                content += "<li class='list-group-item list-group-item-action' data-id=" + val.id + "><div class='d-flex w-100 justify-content-between'><h5 class='mb-1'>" + val.name + "</h5>"
                    + "<small>" + val.date + "</small></div><p class='mb-1'>" + val.contentBrief + "</p><div class='d-flex w-100 justify-content-between'><small>" + val.author + "</small><small>" + val.category + "</small></div></li>";
            })
            content += "</ul>"
            $("#tab1").html(content);
            $("#footerParent").empty();

        }



        function showResult(result) {
            $('<div>').appendTo('body').addClass('alert alert-success').html('操作成功').show().delay(1500).fadeOut();
        }

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>

</body>

</html>