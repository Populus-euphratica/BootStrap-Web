<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">
  <link rel="stylesheet" href="https://static.pingendo.com/bootstrap/bootstrap-4.3.1.css">
  <script src="../jquery/jquery-3.4.1.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container justify-content-center"> <button class="navbar-toggler navbar-toggler-right border-0"
        type="button" data-toggle="collapse" data-target="#navbar9">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse text-center justify-content-center" id="navbar9">
        <ul class="navbar-nav">
          <li class="nav-item mx-2"> <a class="nav-link" href="#">Products</a> </li>
          <li class="nav-item mx-2"> <a class="nav-link" href="#">FAQ</a> </li>
          <li class="nav-item mx-2"> <a class="nav-link navbar-brand mr-0 text-white" href="#"><i
                class="fa d-inline fa-lg fa-stop-circle-o"></i>
              <b> BRAND</b></a> </li>
          <li class="nav-item mx-2"> <a class="nav-link" href="#">About us</a> </li>
          <li class="nav-item mx-2"> <a class="nav-link" href="#">Contacts </a> </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-5 text-center"
    style="	background-image: url(image/image4.jpg);	background-position: right bottom;	background-size: cover;	background-repeat: repeat;	background-attachment: fixed;">
    <div class="container">
      <div class="row justify-content-center align-items-center" style="">
        <div class="bg-white p-4 col-10 mx-auto mx-md-0 col-lg-6">
          <h1>API查找</h1>
          <form class="form-inline d-flex justify-content-center">
            <div class="input-group"> <input type="text" class="form-control" placeholder="please input"
                id="searchContent">
            </div>
            <div class="btn-group">
              <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"
                aria-expanded="false"></button>
              <button class="btn btn-primary" type="button" contenteditable="true" id="search">Search</button>
              <div id="dropdownMenu" class="dropdown-menu" x-placement="bottom-start"
                style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">
                <a class="dropdown-item" data-menu="name">name</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" data-menu="category">Category</a>

              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="py-5" style="">
    <div class="container">
      <div class="row">
        <div class="col-3">
          <ul class="nav nav-pills flex-column" id="operation">
            <li class="nav-item"> <a href="" class="nav-link active" data-toggle="pill" data-target="#tabone"
                data-operation="update">编辑API</a> </li>
            <li class="nav-item"><a class="nav-link" href="#" data-target="#tabone" data-toggle="pill"
                data-operation="delete">删除API</a></li>
            <li class="nav-item" style=""> <a class="nav-link" href="" data-toggle="pill" data-target="#tabtwo"
                data-operation="add">添加API</a> </li>
          </ul>
        </div>
        <div class="col-9">
          <div class="tab-content">
            <div class="tab-pane fade active show" id="tabone" role="tabpanel">
              <div class="table-responsive">
                <table class="table table-bordered ">
                  <thead class="thead-dark">
                    <tr>
                      <th style="">#</th>
                      <th>API Name</th>
                      <th>Description</th>
                      <th>Category</th>
                      <th>Versions</th>
                    </tr>
                  </thead>
                  <tbody id="api">
                  </tbody>
                </table>
              </div>
              <div id="footerParent">
              </div>
            </div>
            <div class="tab-pane fade" id="tabtwo" role="tabpanel">
              <div class="mx-auto p-4 col-md-7">
                <h1 class="mb-4 text-center">添加API</h1>
                <form>
                  <div class="form-group"> <input type="text" class="form-control" id="addName" name="name"
                      placeholder="API Name" required="required"> </div>
                  <div class="form-row">
                    <div class="form-group col-md-6"> <input type="text" class="form-control" id="addVersions"
                        name="versions" placeholder="Versions"> </div>
                    <div class="form-group col-md-6"> <input type="text" class="form-control" id="addCategory"
                        name="category" placeholder="Category"> </div>
                  </div>
                  <div class="form-group"> <textarea class="form-control" id="Description" rows="3" name="description"
                      placeholder="Description"></textarea> </div>
                  <button id="addSubmit" class="btn btn-outline-primary btn-block">Add</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center d-md-flex align-items-center"> <i
            class="d-block fa fa-stop-circle fa-2x mr-md-5 text-primary"></i>
          <ul class="nav mx-md-auto d-flex justify-content-center">
            <li class="nav-item"> <a class="nav-link active" href="#">Home</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Features</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Pricing</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">About</a> </li>
          </ul>
          <div class="row">
            <div class="col-md-12 d-flex align-items-center justify-content-md-between justify-content-center my-2"> <a
                href="#">
                <i class="d-block fa fa-facebook-official text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-instagram text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-twitter text-muted fa-lg ml-2"></i>
              </a> </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">
          <p class="mt-2 mb-0">© 2014-2018 Pingendo. All rights reserved</p>
        </div>
      </div>
    </div>
  </div>



  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">编辑API</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- <div class="mx-auto p-4 col-md-7"> -->
          <h1 class="mb-4 text-center">编辑API</h1>
          <form>
            <div class="form-group"> <input type="text" class="form-control" id="updateName" name="name"
                placeholder="API Name" required="required"> </div>
            <div class="form-row">
              <div class="form-group col-md-6"> <input type="text" class="form-control" id="updateVersions"
                  name="versions" placeholder="Versions"> </div>
              <div class="form-group col-md-6"> <input type="text" class="form-control" id="updateCategory"
                  name="category" placeholder="Category"> </div>
            </div>
            <div class="form-group"> <textarea class="form-control" id="updateDescription" name="description" rows="3"
                placeholder="Description"></textarea> </div>
            <!-- <button id="updateSubmit" class="btn btn-outline-primary btn-block">确认更改</button>
              <button type="reset" class="btn btn-outline-primary btn-block">重置</button> -->
          </form>
          <!-- </div> -->
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button> -->
          <button id="determine" class="btn btn-secondary" data-dismiss="modal">确认</button>
          <button type="reset" class="btn btn-primary" data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 定义全局变量方便下面进行页面刷新和实现页面跳转
    var pageNum = 1;
    var searchUrl = "";
    var searchType = "";
    var searchValue = "";
    var data1 = {};
    var operation = "";
    // 实现搜索功能
    function search() {

      $("#search").click(function () {
        var searchContent = $("#searchContent").val();
        if (searchContent == "") {
          searchUrl = "http://localhost:8080/api/api/";
          searchType = "get";
          data1 = {
            "pageNum": pageNum
          };
          ajaxAPI(data1);
        } else if (searchValue == "name") {
          searchUrl = "http://localhost:8080/api/api/name";
          searchType = "get";
          data1 = {
            "name": searchContent,
            "pageNum": pageNum
          };
          ajaxAPI(data1);
        } else if (searchValue == "category") {
          searchUrl = "http://localhost:8080/api/api/category";
          searchType = "get";
          data1 = {
            "category": searchContent,
            "pageNum": pageNum
          };
          ajaxAPI(data1);
        } else {
          searchUrl = "http://localhost:8080/api/api/all";
          searchType = "get";
          data1 = {
            "val": searchContent,
            "pageNum": pageNum
          };
          ajaxAPI(data1);
        }
      });
    }
    $(document).ready(dropdownMenu());
    $(document).ready(search());
    $(document).ready(addAPI());
    $(document).ready(controlTable());
    $(document).ready(APIManager());
    // 实现与服务器的沟通，主要为了减少代码量
    function ajaxAPI(data1) {
      $.ajax({
        url: searchUrl,
        type: searchType,
        data: data1,
        success: function (data) {
          tableContent(data.list);
          if (data.pages > 1) {
            footerContent(data.pageNum, data.hasPreviousPage, data.hasNextPage, data.navigatepageNums);
            footerEnterAPI(data1);
          }
        },
        error: function () {
          $("#api").empty();
          alert("error!!!");
        }
      })
    }
    // 实现页脚在界面的显示
    function footerContent(pageNum, hasPreviousPage, hasNextPage, navigatepageNums) {
      var content = "<ul class='pagination justify-content-center' id='footer'>";
      if (!hasPreviousPage) {
        $.each(navigatepageNums, function (i, val) {
          if (i == 0) {
            content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
          } else if (i <= 3) {
            content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
          } else {
            content += "<li class='page-item'> <a class='page-link' href='#'  data-pagenum=" + val + ">" + "Next" + "</a></li>"
          }
        })
      } else if (!hasNextPage) {
        $.each(navigatepageNums, function (i, val) {
          if (i == 0) {
            content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + "Prev" + "</a></li>"
          } else if (i < Object.keys(navigatepageNums).length - 1) {
            content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
          } else {
            content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
          }
        })
      } else {
        $.each(navigatepageNums, function (i, val) {
          if (i == 0) {
            content += "<li class='page-item'> <a class='page-link'  href='#' data-pagenum=" + val + ">" + "Prev" + "</a></li>"
          } else if (i < 4) {
            if (val != pageNum) {
              content += "<li class='page-item' > <a class='page-link'  href='#' data-pagenum=" + val + ">" + val + "</a></li>"
            } else {
              content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a>								</li>"
            }
          } else {
            content += "<li class='page-item'> <a class='page-link'  href='#' data-pagenum=" + val + ">" + "Next" + "</a></li>"
          }
        })
      }
      content += "</ul>";
      $("#footerParent").html(content)
    }
    // 实现根据页脚进行跳转的功能
    function footerEnterAPI(data1) {
      $("#footer").click(function (event) {
        pageNum = $(event.target).data("pagenum");
        reFresh(data1);
      })
    }
    // 刷新界面
    function reFresh(data1) {
      data1.pageNum = pageNum;
      $.ajax({
        url: searchUrl,
        type: searchType,
        data: data1,
        success: function (data) {
          tableContent(data.list);
          if (data.pages > 1) {
            footerContent(data.pageNum, data.hasPreviousPage, data.hasNextPage, data.navigatepageNums);
            footerEnterAPI(data1);
          }
        },
        error: function () {
          $("#api").empty();
          alert("error!!!");
        }
      })
    }
    // 获取搜索下拉菜单的选项值
    function dropdownMenu() {
      $("#dropdownMenu").click(function (event) {
        searchValue = $(event.target).data("menu");
      })
    }
    // 根据列表填充表格内容
    function tableContent(list) {
      var content = "";
      $.each(list, function (i, val) {
        content += "<tr data-id=" + list[i].id + "><th><input type='checkbox'></th><td data-toggle='modal' data-target='#exampleModal'>" + list[i].name +
          "</td><td data-toggle='modal' data-target='#exampleModal'>" + list[i].descriptionBrief + "</td><td data-toggle='modal' data-target='#exampleModal'>"
          + list[i].category + "</td><td data-toggle='modal' data-target='#exampleModal'>" + list[i].versions + "</td></tr>";
      })
      $("#api").html(content);
      $("#footerParent").empty();

    }
    // 负责控制面板里编辑和删除功能的实现
    function controlTable() {
      operation = $("#operation .nav-link.active").data("operation");
      $("#operation").click(function (event) {
        // var operation = $(event.target).data("operation");
        operation = $(event.target).data("operation");
      })

    }

    function APIManager() {
      $("#api").click(function (event) {
        var id = $(event.target.parentNode).data("id");
        if (operation == "update") {
          updateAPI(id);
        } else if (operation == "delete") {
          deleteAPI(id);
        }
      })
    }
    // 实现更新API功能
    function updateAPI(id) {

      $.ajax({
        url: "http://localhost:8080/api/api/id",
        type: "get",
        data: {
          "id": id
        },
        success: function (data) {
          var updateName = $("#updateName");
          var updateCategory = $("#updateCategory");
          var updateDescription = $("#updateDescription");
          var updateVersions = $("#updateVersions");
          updateName.val(data.name);
          updateCategory.val(data.category);
          updateVersions.val(data.versions);
          updateDescription.text(data.description);
          $("#determine").off();
          $("#determine").click(function () {
            var updateData = {
              "name": updateName.val(),
              "category": updateCategory.val(),
              "versions": updateVersions.val(),
              "description": updateDescription.text(),
              "id": data.id
            };
            if (updateData.description.length == 0) {
              updateData.descriptionBrief = "";
            } else if (updateData.description.length > 300) {
              updateData.descriptionBrief = updateData.description.substring(0, 200) + "...";
            } else {
              updateData.descriptionBrief = updateData.description;
            }
            data = {};
            $.ajax({
              url: "http://localhost:8080/api/api/id",
              type: "put",
              data: JSON.stringify(updateData),
              contentType: "application/json;charset=utf-8;",
              dataType: "json",
              success: function (flag) {
                if (flag) {
                  alert("success!!!");
                  reFresh(data1);
                } else {
                  alert("更新失败");
                }

              },
              error: function () {
                alert("更新失败error");
              }
            })


          })
        },
        error: function () {
          alert("更新失败!!!");
        }
      })

    }
    // 实现删除API的功能
    function deleteAPI(id) {

      $(".modal-title").val = "删除API";
      $(".modal-body").html("<p>您确定要删除这条API吗？</p>");
      $("#determine").off();
      $("#determine").click(function () {
        $.ajax({
          url: "http://localhost:8080/api/api/id",
          type: "delete",
          data: {
            "id": id
          },
          success: function (flag) {
            if (flag) {
              alert("success!!!");
              reFresh(data1);
            } else {
              alert("更新失败");
            }

          },
          error: function () {
            alert("更新失败error");
          }
        })
      })


    }
    // 实现添加API的功能
    function addAPI() {
      $("#addSubmit").click(function () {
        var addData = {
          "name": $("#addName").val(),
          "category": $("#addCategory").val(),
          "versions": $("#addVersions").val(),
          "description": $("#addDescription").text(),
        };
        alert(addData.description);
        if (addData.description.length == 0) {
          addData.descriptionBrief = "";
        } else if (addData.description.length > 300) {
          addData.descriptionBrief = addData.description.substring(0, 200) + "...";
        } else {
          addData.descriptionBrief = addData.description;
        }
        $.ajax({
          url: "http://localhost:8080/api/api/",
          type: "post",
          data: JSON.stringify(addData),
          contentType: "application/json;charset=utf-8;",
          dataType: "json",
          success: function (flag) {
            if (flag) {
              alert("success!!!");
            } else {
              alert("添加失败");
            }

          },
          error: function () {
            alert("添加失败error");
          }
        })
      })
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"
    style=""></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</body>

</html>