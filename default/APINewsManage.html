<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">
  <link rel="stylesheet" href="../css/bootstrap-4.3.1.css">
  <script src="../jquery/jquery-3.4.1.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container"> <button class="navbar-toggler navbar-toggler-right border-0" type="button"
        data-toggle="collapse" data-target="#navbar12">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar12"> <a class="navbar-brand d-none d-md-block" href="#">
          <i class="fa d-inline fa-lg fa-circle"></i>
          <b> BRAND</b>
        </a>
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"> <a class="nav-link" href="#">API管理</a> </li>
          <li class="nav-item"> <a class="nav-link" href="#">用户管理</a> </li>
          <li class="nav-item"> <a class="nav-link" href="#">新闻管理</a> </li>
          <li class="nav-item"><a class="nav-link" href="#">综合数据</a></li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item"> <a class="nav-link text-primary" href="#"><i class="fa fa-bell-o"
                aria-hidden="true"></i>Message</a> </li>
          <li class="nav-item"> <a class="nav-link text-primary" href="#"><i class="fa fa-user fa-fw"></i>Log in</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-5 text-center"
    style="background-image: url(&quot;image/image4.jpg&quot;); background-position: right bottom; background-size: cover; background-repeat: repeat; background-attachment: fixed;">
    <div class="container">
      <div class="row justify-content-center align-items-center" style="">
        <div class="bg-white p-4 col-10 mx-auto mx-md-0 col-lg-6">
          <h1>新闻查找</h1>
          <form class="form-inline d-flex justify-content-center">
            <div class="input-group"> <input type="search" class="form-control" placeholder="please input" id="form6">
              <div class="btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                  data-toggle="dropdown" aria-expanded="false"></button>
                <div class="input-group-append"> <button class="btn btn-primary" id="search" type="button"
                    contenteditable="true">Search</button> </div>
                <div class="dropdown-menu" id="dropdownMenu" x-placement="bottom-start"
                  style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">
                  <a class="dropdown-item" data-menu="name" href="#">资讯名称</a>
                  <a class="dropdown-item" data-menu="author" href="#">作者</a>
                  <a class="dropdown-item" data-menu="date" href="#">日期</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" data-menu="dateSection" href="#">日期区间</a>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-3">
          <ul class="nav nav-pills flex-column">
            <li class="nav-item" style=""> <a href="" class="nav-link active" data-toggle="pill"
                data-target="#tabone">查看新闻</a> </li>
            <li class="nav-item" style=""> <a class="nav-link" href="" data-toggle="pill" data-target="#tabtwo">发布新闻</a>
            </li>
          </ul>
        </div>
        <div class="col-9">
          <div class="tab-content">
            <div class="tab-pane fade active show" id="tabone" role="tabpanel">
              <div id="tab1" class="d-flex justify-content-center">
                <div class="card mb-3" style="max-width: 540px;">
                  <div class="row no-gutters">
                    <div class="col-md-4 align-self-center">
                      <img src="image/image4.jpg" class="card-img " alt="...">
                    </div>
                    <div class="col-md-8">
                      <div class="card-body">
                        <h5 class="card-title">Card title</h5>
                        <p class="card-text">This is a wider card with supporting text below as a natural lead-in to
                          additional content. This content is a little bit longer.</p>
                        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="footerParent">
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="tabtwo" role="tabpanel">
              <div class="mx-auto p-4 col-md-7">
                <h1 class="mb-4 text-center">发布新闻</h1>
                <form>
                  <div class="form-group"> <input type="text" class="form-control" id="form33" placeholder="新闻名称"
                      required="required"> </div>
                  <div class="form-row">
                    <div class="form-group col-md-6"> <input type="text" class="form-control" id="form27"
                        placeholder="作者"> </div>
                    <div class="form-group col-md-6"> <input type="date" class="form-control" id="form28"
                        placeholder="时间"> </div>
                  </div>
                  <div class="form-group"> <textarea class="form-control" id="form35" rows="10"
                      placeholder="正文内容"></textarea> </div> <button type="submit"
                    class="btn btn-outline-primary btn-block">Add</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    

// 定义全局变量方便下面进行页面刷新和实现页面跳转
var pageNum = 1;
var searchUrl = "";
var searchType = "";
var searchValue = "";
var data1 = {};
// 实现搜索功能
function search() {

  $("#search").click(function () {
    var searchContent = $("#searchContent").val();
    if (searchContent == "") {
      searchUrl = "http://localhost:8080/api/apiNews/";
      searchType = "get";
      data1 = {
        "pageNum": pageNum
      };
      ajaxAPI(data1);
    } else if (searchValue == "name") {
      searchUrl = "http://localhost:8080/api/apiNews/name";
      searchType = "get";
      data1 = {
        "name": searchContent,
        "pageNum": pageNum
      };
      ajaxAPI(data1);
    } else if (searchValue == "author") {
      searchUrl = "http://localhost:8080/api/apiNews/author";
      searchType = "get";
      data1 = {
        "author": searchContent,
        "pageNum": pageNum
      };
      ajaxAPI(data1);
    } else if (searchValue == "data") {
      searchUrl = "http://localhost:8080/api/apiNews/data";
      searchType = "get";
      data1 = {
        "data": searchContent,
        "pageNum": pageNum
      };
      ajaxAPI(data1);
    }else if (searchValue == "dateSection") {
      searchUrl = "http://localhost:8080/api/apiNews/dateSection";
      searchType = "get";
      data1 = {
        "dateSection": searchContent,
        "pageNum": pageNum
      };
      ajaxAPI(data1);
    }else {
      searchUrl = "http://localhost:8080/api/apiNews/all";
      searchType = "get";
      data1 = {
        "val": searchContent,
        "pageNum": pageNum
      };
      ajaxAPI(data1);
    }
  });
}
$(document).ready(dropdownMenu());
$(document).ready(search());
$(document).ready(addAPI());
$(document).ready(APIManager());
// 实现与服务器的沟通，主要为了减少代码量
function ajaxAPI(data1) {
  $.ajax({
    url: searchUrl,
    type: searchType,
    data: data1,
    success: function (data) {
      tableContent(data.list);
      if (data.pages > 1) {
        footerContent(data.pageNum, data.hasPreviousPage, data.hasNextPage, data.navigatepageNums);
        footerEnterAPI(data1);
      }
      showResult("查询成功");
    },
    error: function () {
      $("#tab1").empty();
      showResult("error!!!");
    }
  })
}
// 实现页脚在界面的显示
function footerContent(pageNum, hasPreviousPage, hasNextPage, navigatepageNums) {
  var content = "<ul class='pagination justify-content-center' id='footer'>";
  if (!hasPreviousPage) {
    $.each(navigatepageNums, function (i, val) {
      if (i == 0) {
        content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
      } else if (i <= 3) {
        content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
      } else {
        content += "<li class='page-item'> <a class='page-link' href='#'  data-pagenum=" + val + ">" + "Next" + "</a></li>"
      }
    })
  } else if (!hasNextPage) {
    $.each(navigatepageNums, function (i, val) {
      if (i == 0) {
        content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + "Prev" + "</a></li>"
      } else if (i < Object.keys(navigatepageNums).length - 1) {
        content += "<li class='page-item'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
      } else {
        content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a></li>"
      }
    })
  } else {
    $.each(navigatepageNums, function (i, val) {
      if (i == 0) {
        content += "<li class='page-item'> <a class='page-link'  href='#' data-pagenum=" + val + ">" + "Prev" + "</a></li>"
      } else if (i < 4) {
        if (val != pageNum) {
          content += "<li class='page-item' > <a class='page-link'  href='#' data-pagenum=" + val + ">" + val + "</a></li>"
        } else {
          content += "<li class='page-item active'> <a class='page-link' href='#' data-pagenum=" + val + ">" + val + "</a>								</li>"
        }
      } else {
        content += "<li class='page-item'> <a class='page-link'  href='#' data-pagenum=" + val + ">" + "Next" + "</a></li>"
      }
    })
  }
  content += "</ul>";
  $("#footerParent").html(content)
}
// 实现根据页脚进行跳转的功能
function footerEnterAPI(data1) {
  $("#footer").click(function (event) {
    pageNum = $(event.target).data("pagenum");
    reFresh(data1);
  })
}
// 刷新界面
function reFresh(data1) {
  data1.pageNum = pageNum;
  $.ajax({
    url: searchUrl,
    type: searchType,
    data: data1,
    success: function (data) {
      tableContent(data.list);
      if (data.pages > 1) {
        footerContent(data.pageNum, data.hasPreviousPage, data.hasNextPage, data.navigatepageNums);
        footerEnterAPI(data1);
      }
    },
    error: function () {
      $("#tab1").empty();
      showResult("刷新界面失败!!!");
    }
  })
}
// 获取搜索下拉菜单的选项值
function dropdownMenu() {
  $("#dropdownMenu").click(function (event) {
    searchValue = $(event.target).data("menu");
  })
}
// 根据列表填充表格内容
function tableContent(list) {
  var content = "";
  $.each(list, function (i, val) {
    content += "<tr data-id=" + list[i].id + "><th><input type='checkbox'></th><td data-toggle='modal' data-target='#exampleModal'>" + list[i].name +
      "</td><td data-toggle='modal' data-target='#exampleModal'>" + list[i].descriptionBrief + "</td><td data-toggle='modal' data-target='#exampleModal'>"
      + list[i].category + "</td><td data-toggle='modal' data-target='#exampleModal'>" + list[i].versions + "</td></tr>";
  })
  $("#api").html(content);
  $("#footerParent").empty();

}
// 负责控制面板里编辑和删除功能的实现

function APIManager() {
  $("#api").click(function (event) {
    var operation = $("#operation .nav-link.active").data("operation");
    var id = $(event.target.parentNode).data("id");
    if (operation == "update") {
      updateAPI(id);
    } else if (operation == "delete") {
      deleteAPI(id);
    }
  })
}
// 实现更新API功能
function updateAPI(id) {

  $.ajax({
    url: "http://localhost:8080/api/api/id",
    type: "get",
    data: {
      "id": id
    },
    success: function (data) {
      var updateName = $("#updateName");
      var updateCategory = $("#updateCategory");
      var updateDescription = $("#updateDescription");
      var updateVersions = $("#updateVersions");
      updateName.val(data.name);
      updateCategory.val(data.category);
      updateVersions.val(data.versions);
      updateDescription.text(data.description);
      $("#determine").off();
      $("#determine").click(function () {
        var updateData = {
          "name": updateName.val(),
          "category": updateCategory.val(),
          "versions": updateVersions.val(),
          "description": updateDescription.text(),
          "id": data.id
        };
        if (updateData.description.length == 0) {
          updateData.descriptionBrief = "";
        } else if (updateData.description.length > 300) {
          updateData.descriptionBrief = updateData.description.substring(0, 200) + "...";
        } else {
          updateData.descriptionBrief = updateData.description;
        }
        data = {};
        $.ajax({
          url: "http://localhost:8080/api/api/id",
          type: "put",
          data: JSON.stringify(updateData),
          contentType: "application/json;charset=utf-8;",
          dataType: "json",
          success: function (flag) {
            if (flag) {
              showResult("更新成功!!!");
              reFresh(data1);
            } else {
              showResult("更新失败");
            }

          },
          error: function () {
            showResult("更新失败error");
          }
        })


      })
    },
    error: function () {
      showResult("更新失败!!!");
    }
  })

}
// 实现删除API的功能
function deleteAPI(id) {

  $(".modal-title").val = "删除API";
  $(".modal-body").html("<p>您确定要删除这条API吗？</p>");
  $("#determine").off();
  $("#determine").click(function () {
    $.ajax({
      url: "http://localhost:8080/api/api/id",
      type: "delete",
      data: {
        "id": id
      },
      success: function (flag) {
        if (flag) {
          showResult("删除成功!!!");
          reFresh(data1);
        } else {
          showResult("删除失败");
        }

      },
      error: function () {
        showResult("删除失败");
      }
    })
  })


}
// 实现添加API的功能
function addAPI() {
  $("#addSubmit").click(function () {
    var addName = $("#addName");
    var addCategory = $("#addCategory");
    var addDescription = $("#addDescription");
    var addVersions = $("#addVersions");
    if (addName.val() == "") {
      showResult("请输入值")
      return;
    }
    var addData = {
      "name": addName.val(),
      "category": addCategory.val(),
      "versions": addVersions.val(),
      "description": addDescription.val()
    };
    if (addData.description.length == 0) {
      addData.descriptionBrief = "";
    } else if (addData.description.length > 300) {
      addData.descriptionBrief = addData.description.substring(0, 200) + "...";
    } else {
      addData.descriptionBrief = addData.description;
    }
    $.ajax({
      url: "http://localhost:8080/api/api/",
      type: "post",
      data: JSON.stringify(addData),
      contentType: "application/json;charset=utf-8",
      dataType: "text",
      success: function (flag) {
        addName.val("");
        addCategory.val("");
        addDescription.val("");
        addVersions.val("");
        if (flag) {
          showResult("添加成功!!!");
        } else {
          showResult("添加失败");
        }
      },
      error: function () {
        showResult("添加失败error");
      }
    })
  })
}

function showResult(result) {
  $('<div>').appendTo('body').addClass('alert alert-success').html('操作成功').show().delay(1500).fadeOut();
}

  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</body>

</html>