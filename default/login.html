<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">
  <link rel="stylesheet" href="../css/bootstrap-4.3.1.css">
  <script src="../jquery/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container"> <button class="navbar-toggler navbar-toggler-right border-0" type="button"
        data-toggle="collapse" data-target="#navbar12">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar12"> <a class="navbar-brand d-none d-md-block" href="#">
          <i class="fa d-inline fa-lg fa-circle"></i>
          <b> BRAND</b>
        </a>
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"> <a class="nav-link text-primary" href="#" contenteditable="true">WebAPI</a> </li>
          <li class="nav-item"> <a class="nav-link text-primary" href="#">首页</a> </li>
          <li class="nav-item"> <a class="nav-link text-primary" href="#">新闻动态</a> </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item"> <a href="#" id="state" data-state="user" class="nav-link text-primary"><i
                class="fa fa-user fa-fw"></i>Admin Sign</a> </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <div id="carouselExampleIndicators" class="carousel slide carousel-fade" data-ride="carousel">
            <ol class="carousel-indicators">
              <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"> </li>
              <li data-target="#carouselExampleIndicators" data-slide-to="1"> </li>
              <li data-target="#carouselExampleIndicators" data-slide-to="2"> </li>
            </ol>
            <div class="carousel-inner">
              <div class="carousel-item active"> <img class="d-block img-fluid w-100" src="image/image3.jpg">
                <div class="carousel-caption">
                  <h5 class="m-0">Carousel</h5>
                  <p>with indicators</p>
                </div>
              </div>
              <div class="carousel-item "> <img class="d-block img-fluid w-100" src="image/image4.jpg">
                <div class="carousel-caption">
                  <h5 class="m-0">Carousel</h5>
                  <p>with indicators</p>
                </div>
              </div>
              <div class="carousel-item"> <img class="d-block img-fluid w-100" src="image/image5.jpg">
                <div class="carousel-caption">
                  <h5 class="m-0">Carousel</h5>
                  <p>with indicators</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <form class="needs-validation" novalidate="" id="loginFrom">
            <h1 id="title" class="text-center">用户登录</h1>
            <div class="form-group">
              <label for="InputEmail">Email address</label>
              <input type="email" class="form-control" id="email" aria-describedby="emailHelp"
                placeholder="name@example.com" required="true">
              <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
              <small id="emailNote" class="form-text text-muted"></small>
            </div>
            <div class="form-group">
              <label for="InputPassword">Password</label>
              <input type="password" class="form-control" id="password" placeholder="your password" required="true">
              <small id="passwordNote" class="form-text text-muted"></small>
            </div>
            <div class="d-flex justify-content-between pb-3">
              <small class="form-text text-muted text-left">
                <a href="register.html">没有账户？注册一个</a>
              </small>
              <small class="form-text text-muted text-right">
                <a href="#">忘记密码</a>
              </small>
            </div>
            <div class="d-flex align-items-end flex-column">
              <div class="form-group form-check">
                <input type="checkbox" class="form-check-input" id="remember">
                <label class="form-check-label" for="remember">记住密码</label>
              </div>
              <button type="submit" class="btn btn-primary ">登录</button>
            </div>
            <div class="d-flex flex-row-reverse">
              <small id="error" class="text-muted pt-2"></small>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center d-md-flex align-items-center"> <i
            class="d-block fa fa-stop-circle fa-2x mr-md-5 text-primary"></i>
          <ul class="nav mx-md-auto d-flex justify-content-center">
            <li class="nav-item"> <a class="nav-link active" href="#">Home</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Features</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Pricing</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">About</a> </li>
          </ul>
          <div class="row">
            <div class="col-md-12 d-flex align-items-center justify-content-md-between justify-content-center my-2"> <a
                href="#">
                <i class="d-block fa fa-facebook-official text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-instagram text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-twitter text-muted fa-lg ml-2"></i>
              </a> </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">
          <p class="mt-2 mb-0">© 2014-2018 Pingendo. All rights reserved</p>
        </div>
      </div>
    </div>
  </div>
  <script style="">
    var email = $("#email");
    var password = $("#password");
    // 检查格式
    function check() {
      var rep = /^[a-zA-Z0-9]+@(\d{3}|[a-zA-Z]{2,4}).[a-zA-Z]{2,3}$/;
      if (!rep.test(email.val())) {
        email.focus();
        $("#emailNote").text("邮箱格式不对！");
        return false;
      }
      $("#emailNote").text("");
      if (password.val() != "" || password.val() != null || $.trim(password.val()).length == 0) {
        password.focus();
        $("#passwordNote").text("密码不能为空！")
        return false;
      }
      $("#passwordNote").text("");

      return true;
    }
    // 切换登录模式
    $("#state").click(function () {
      if ($(this).data("state") == "user") {
        $(this).data("state", "admin");
        $("#title").text("管理员登录");
        $(this).html("<i class='fa fa-user-circle-o' aria-hidden='true'></i>User Sign");
      } else if ($(this).data("state") == "admin") {
        $(this).data("state", "user");
        $("#title").text("用户登录");
        $(this).html("<i class='fa fa-user fa-fw' aria-hidden='true'></i>Admin Sign");
      }
    });

    $(document).ready(remember());
    // 登录
    function loginWeb() {
      var state = $("#state").data("state");
      var loginData = {
        "email": email.val(),
        "password": password.val()
      };
      $.ajax({
        url: "http://localhost:8080/api/" + state + "/login",
        dataType: "json",
        type: "post",
        contentType: "application/json;charset=utf-8;",
        data: JSON.stringify(loginData),
        success: function (data) {
          if (data) {
            $.ajax({
              url: "http://localhost:8080/api/" + state + "/email",
              type: "get",
              data: {
                "email": email.val()
              },
              success: function(data){
                sessionStorage.setItem("login", "true");
                sessionStorage.setItem("state",state);
                sessionStorage.setItem("stateData",JSON.stringify(data));
                if (state == "user") {
                  window.location.href = "home.html";
                } else if (state == "admin") {
                  window.location.href = "UserManage.html";
                }
              }
            })

          } else {
            $("#error").html("账号或密码错误");
          }
        },
        error: function () {
          alert("访问服务器失败");
        }
      })
    }
    // 记住密码
    function remember() {
      if ($.cookie("email") && $.cookie("password")) {
        email.val($.cookie("email"));
        password.val($.cookie("password"));
        $("#remember").attr("checked", 'checked');
        alert(password)
      }
      $("#loginFrom").submit(function (e) {
        e.preventDefault();
        if ($("#remember").is(":checked")) {
          $.cookie("email", email.val(), { path: "/", expires: 7 });
          $.cookie("password", password.val(), { path: "/", expires: 7 });
        } else {
          $.cookie("email", null);
          $.cookie("password", null);
        }
        loginWeb();
      });
    };
  </script>
</body>


</html>