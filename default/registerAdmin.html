<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    type="text/css">
  <link rel="stylesheet" href="../css/bootstrap-4.3.1.css">
  <script src="../jquery/jquery-3.4.1.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="container justify-content-center"> <button class="navbar-toggler navbar-toggler-right border-0"
        type="button" data-toggle="collapse" data-target="#navbar9">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse text-center justify-content-center" id="navbar9">
        <ul class="navbar-nav">
          <li class="nav-item mx-2"> <a class="nav-link" href="#">首页</a> </li>
          <li class="nav-item mx-2"> <a class="nav-link" href="#">搜索</a> </li>
          <li class="nav-item mx-2"> <a class="nav-link navbar-brand mr-0 text-white" href="#"><i
                class="fa d-inline fa-lg fa-stop-circle-o"></i>
              <b> BRAND</b></a> </li>
          <li class="nav-item mx-2"> <a class="nav-link" href="#">登录/注册</a> </li>
          <li class="nav-item mx-2"> <a class="nav-link" href="#">联系我们</a> </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-5 text-center">
    <div class="container">
      <div class="row">
        <div class="mx-auto col-lg-6 col-10">
          <h1>注册用户账号</h1>
          <p class="mb-3">请您完成以下各项信息的填写，我们会保障您的个人隐私不会泄露及滥用。</p>
          <form class="text-left" id="registerUser">
            <div class="form-group"> <label for="userName">Your Name</label> 
              <input type="text" class="form-control" id="userName" placeholder="name" required="required">
              <small id="nameNote" class="form-text text-muted"></small>
            </div>
            <div class="form-group"> <label for="company">Your Company</label> <input type="text" class="form-control"
                id="company" placeholder="company"> </div>
            <div class="form-group"> <label for="email">Your email</label> <input type="email" class="form-control"
                id="email" placeholder="name@example.com" required="required">
              <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
              <small id="emailNote" class="form-text text-muted"></small>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6"> <label for="password"">Password</label> <input type="password"
                  class="form-control" id="password" required="required"> 
                  <small id="passwordNote" class="form-text text-muted"></small>
                </div>
              <div class="form-group col-md-6"> <label for="confirmPassword">Confirm Password</label> <input
                  type="password" class="form-control" id="confirmPassword" required="required"> </div>
              
            </div>
            <div class="d-flex justify-content-center">
              <button type="submit" class="btn btn-primary">注册</button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
  <div class="py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center d-md-flex align-items-center"> <i
            class="d-block fa fa-stop-circle fa-2x mr-md-5 text-primary"></i>
          <ul class="nav mx-md-auto d-flex justify-content-center">
            <li class="nav-item"> <a class="nav-link active" href="#">Home</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Features</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">Pricing</a> </li>
            <li class="nav-item"> <a class="nav-link" href="#">About</a> </li>
          </ul>
          <div class="row">
            <div class="col-md-12 d-flex align-items-center justify-content-md-between justify-content-center my-2"> <a
                href="#">
                <i class="d-block fa fa-facebook-official text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-instagram text-muted fa-lg mx-2"></i>
              </a> <a href="#">
                <i class="d-block fa fa-twitter text-muted fa-lg ml-2"></i>
              </a> </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">
          <p class="mt-2 mb-0">© 2014-2018 Pingendo. All rights reserved</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    
    var email = $("#email");
    var userName = $("#userName");
    var company = $("#company");
    var nameNote = $("#nameNote");
    var password = $("#password");
    var passwordNote = $("#passwordNote");
    var emailNote = $("#emailNote");
    $(document).ready(registerUser());


    function check() {
      if ($.trim(userName.val()) == "") {
        userName.focus();
        nameNote.text("请输入名称!");
        return false;
      }
      nameNote.text("");
      var rep = /^[a-zA-Z0-9]+@(\d{3}|[a-zA-Z]{2,4}).[a-zA-Z]{2,3}$/;
      if (!rep.test($.trim(email.val()))) {
        email.focus();
        emailNote.text("邮箱格式不对！");
        return false;
      }
      emailNote.text("");
      if (password.val() != $("#confirmPassword").val()) {
        passwordNote.text("密码不一致！")
        return false;
      }
      if ($.trim(password.val()) == "") {
        password.focus();
        passwordNote.text("密码不能为空！")
        return false;
      }
      passwordNote.text("");

      return true;
    }


    function registerUser() {
      $("#registerUser").submit(function (e) {
        e.preventDefault();
        if (!check()) {
          return false;
        }

        var registerDate = {
          "name": $.trim(userName.val()),
          "company": $.trim(company.val()),
          "email": $.trim(email.val()),
          "password": $.trim(password.val())
        };
        $.ajax({
          url: "http://localhost:8080/api/user/email",
          type: "get",
          data: {
            "email": $.trim(email.val())
          },
          success: function (emailDate) {
            if (emailDate.id != null) {
              emailNote.text("该邮箱已被其他人使用");
              email.focus();
              return;
            } else {
              $.ajax({
                url: "http://localhost:8080/api/user/",
                type: "post",
                data: JSON.stringify(registerDate),
                contentType: "application/json;charset=utf-8;",
                dataType: "json",
                success: function (data) {
                  if (data) {
                    alert("注册成功！");
                    window.location.href = "login.html";
                  } else {
                    alert("注册失败！");
                  }
                },
                error: function () {
                  alert("连接服务器出错！");
                }
              })
            }
          },
          error: function () {
            alert("连接服务器出错！");
          }
        })

      })
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</body>

</html>